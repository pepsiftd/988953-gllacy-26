function modal(a,b){this.button=a,this.modal_window=b,this.clicked=!1}var search=new modal(document.querySelector(".search-button"),document.querySelector(".modal-search")),login=new modal(document.querySelector(".login-button"),document.querySelector(".modal-login")),basket=new modal(document.querySelector(".basket-button"),document.querySelector(".modal-basket")),feedback_button=document.querySelector(".feedback-button"),modal_feedback=document.querySelector(".modal-feedback"),feedback_close=document.querySelector(".modal-feedback .modal-close"),overlay=document.querySelector(".overlay"),all_modal_windows=[search,login,basket],delay=200,show=function(a){a.classList.add("modal-show")},hide=function(a){a.classList.remove("modal-show")},modal_show_on_hover=function(a){if(!a.modal_window)return 0;var b=null;a.button.addEventListener("mouseover",function(){show(a.modal_window),clearTimeout(b)}),a.button.addEventListener("mouseout",function(){a.clicked||(b=setTimeout(function(){hide(a.modal_window)},delay))}),a.modal_window.addEventListener("mouseover",function(){clearTimeout(b)}),a.modal_window.addEventListener("click",function(){clearTimeout(b),a.clicked=!0}),a.modal_window.addEventListener("mouseout",function(){a.clicked||(b=setTimeout(function(){hide(a.modal_window)},delay))})};modal_show_on_hover(search),modal_show_on_hover(login),modal_show_on_hover(basket),document.addEventListener("click",function(a){var b=a.target;all_modal_windows.forEach(function(a){a.modal_window&&b!=a.modal_window&&!a.modal_window.contains(b)&&(a.modal_window.classList.remove("modal-error"),hide(a.modal_window),a.clicked=!1)})}),window.addEventListener("keydown",function(a){27===a.keyCode&&(all_modal_windows.forEach(function(b){return b.modal_window&&b.modal_window.classList.contains("modal-show")?(a.preventDefault(),b.modal_window.classList.remove("modal-error"),hide(b.modal_window),b.clicked=!1,b.button.focus(),0):void 0}),modal_feedback&&modal_feedback.classList.contains("modal-show")&&(a.preventDefault(),modal_feedback.classList.remove("modal-error"),modal_feedback.classList.remove("bounce"),hide(modal_feedback),hide(overlay),feedback_button.focus()))});var search_input=document.querySelector(".search-input"),login_input=document.querySelector(".modal-login-email-input"),password_input=document.querySelector(".modal-login-password-input"),basket_input=document.querySelector(".order-button");search.button.addEventListener("keydown",function(a){"Enter"===a.key&&(a.preventDefault(),show(search.modal_window),search_input.focus())}),login.button.addEventListener("keydown",function(a){"Enter"===a.key&&(a.preventDefault(),show(login.modal_window),login_input.value?password_input.focus():login_input.focus())}),basket.modal_window&&basket.button.addEventListener("keydown",function(a){"Enter"===a.key&&(a.preventDefault(),show(basket.modal_window),basket_input.focus())});var storage_login="",storage_is_supported=!0;try{storage_login=localStorage.getItem("login")}catch(err){storage_is_supported=!1}storage_login&&(login_input.value=storage_login);var login_form=document.querySelector(".modal-login form");login_form.addEventListener("submit",function(a){login_input.value&&password_input.value?storage_is_supported&&localStorage.setItem("login",login_input.value):(a.preventDefault(),login.modal_window.classList.remove("modal-error"),login.modal_window.offsetWidth=login.modal_window.offsetWidth,login.modal_window.classList.add("modal-error"))});var feedback_name=document.querySelector("#name"),feedback_email=document.querySelector("#feedback-email"),feedback_comment=document.querySelector("#comment");modal_feedback&&(feedback_button.addEventListener("click",function(a){a.preventDefault(),show(modal_feedback),show(overlay),modal_feedback.classList.add("bounce");var b="",c="";storage_is_supported&&(b=localStorage.getItem("name"),c=localStorage.getItem("feedback_email")),b&&c?(feedback_name.value=b,feedback_email.value=c,feedback_comment.focus()):feedback_name.focus()}),feedback_close.addEventListener("click",function(a){a.preventDefault(),modal_feedback.classList.remove("modal-error"),modal_feedback.classList.remove("bounce"),hide(modal_feedback),hide(overlay)}),modal_feedback.addEventListener("submit",function(a){feedback_name.value&&feedback_email.value?storage_is_supported&&(localStorage.setItem("name",feedback_name.value),localStorage.setItem("feedback_email",feedback_email.value)):(a.preventDefault(),modal_feedback.classList.remove("modal-error"),modal_feedback.offsetWidth=modal_feedback.offsetWidth,modal_feedback.classList.add("modal-error"))}));